Use a better stable sort than bubble sort
free all allocated memory